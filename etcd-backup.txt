
############ Create BackUp ETCD  ##########

ETCDCTL_API=3 etcdctl snapshot save snapshotdb --endpoints=https://172.31.12.220:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key


## verify data file 
etcdutl --write-out=table snapshot status snapshotdb


###########   Restore ETCD   ################

ETCDCTL_API=3 etcdutl snapshot restore snapshotdb --name server --initial-cluster server=https://172.31.12.220:2380 --initial-advertise-peer-urls https://172.31.12.220:2380 --data-dir /var/lib/etcd-1


update etcd.yaml's hostpath volume to /var/lib/etcd-1


vi /etc/kubernetes/manifests/etcd.yaml



systemctl restart crio
systemctl restart kubelet.service


if containers are not getting recreated than follow steps
crictl rm --force $(crictl ps -a -q)

systemctl restart kubelet.service

restart cilium 

kubectl delete pods -n kube-system -l k8s-app=cilium

